From 5fb18e7b8ab9ee0b1af375aa13135cf0dfe30874 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?St=C3=A9phane=20Graber?= <stgraber@ubuntu.com>
Date: Thu, 5 Nov 2020 15:17:02 -0500
Subject: [PATCH lxcfs 3/8] cgroups: Add get_memory_swappiness
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: St√©phane Graber <stgraber@ubuntu.com>
---
 src/cgroups/cgfsng.c | 7 +++++++
 src/cgroups/cgroup.h | 2 ++
 2 files changed, 9 insertions(+)

diff --git a/src/cgroups/cgfsng.c b/src/cgroups/cgfsng.c
index 824b0e7..d772f25 100644
--- a/src/cgroups/cgfsng.c
+++ b/src/cgroups/cgfsng.c
@@ -620,6 +620,12 @@ static int cgfsng_get_memory_max(struct cgroup_ops *ops, const char *cgroup,
 	return cgfsng_get_memory(ops, cgroup, "memory.max", value);
 }
 
+static int cgfsng_get_memory_swappiness(struct cgroup_ops *ops, const char *cgroup,
+				 char **value)
+{
+	return cgfsng_get_memory(ops, cgroup, "memory.swappiness", value);
+}
+
 static int cgfsng_get_memory_swap_max(struct cgroup_ops *ops,
 				      const char *cgroup, char **value)
 {
@@ -1011,6 +1017,7 @@ struct cgroup_ops *cgfsng_ops_init(void)
 	cgfsng_ops->get_memory_stats_fd = cgfsng_get_memory_stats_fd;
 	cgfsng_ops->get_memory_stats = cgfsng_get_memory_stats;
 	cgfsng_ops->get_memory_max = cgfsng_get_memory_max;
+	cgfsng_ops->get_memory_swappiness = cgfsng_get_memory_swappiness;
 	cgfsng_ops->get_memory_swap_max = cgfsng_get_memory_swap_max;
 	cgfsng_ops->get_memory_current = cgfsng_get_memory_current;
 	cgfsng_ops->get_memory_swap_current = cgfsng_get_memory_swap_current;
diff --git a/src/cgroups/cgroup.h b/src/cgroups/cgroup.h
index ad4a3ae..f4b5d19 100644
--- a/src/cgroups/cgroup.h
+++ b/src/cgroups/cgroup.h
@@ -151,6 +151,8 @@ struct cgroup_ops {
 				       const char *cgroup, char **value);
 	int (*get_memory_max)(struct cgroup_ops *ops, const char *cgroup,
 			      char **value);
+	int (*get_memory_swappiness)(struct cgroup_ops *ops, const char *cgroup,
+			      char **value);
 	int (*get_memory_swap_max)(struct cgroup_ops *ops, const char *cgroup,
 				   char **value);
 	bool (*can_use_swap)(struct cgroup_ops *ops);
-- 
2.20.1

