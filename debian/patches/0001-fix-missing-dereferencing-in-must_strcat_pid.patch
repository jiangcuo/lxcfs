From ab9a41700a2b9d422ab0fda1fe3873b4ae70b47b Mon Sep 17 00:00:00 2001
From: Wolfgang Bumiller <w.bumiller@proxmox.com>
Date: Thu, 7 Jan 2016 11:23:24 +0100
Subject: [PATCH lxcfs 1/5] fix missing dereferencing in must_strcat_pid

Fixes a segfault when reading a /tasks file of a cgroup
containing a large number of pids.

Signed-off-by: Wolfgang Bumiller <w.bumiller@proxmox.com>
---
 lxcfs.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/lxcfs.c b/lxcfs.c
index fe5ac3e..767a344 100644
--- a/lxcfs.c
+++ b/lxcfs.c
@@ -85,7 +85,7 @@ static void must_strcat_pid(char **src, size_t *sz, size_t *asz, pid_t pid)
 		} while (!d);
 		*src = d;
 		*asz = BUF_RESERVE_SIZE;
-	} else if (strlen(tmp) + sz + 1 >= asz) {
+	} else if (strlen(tmp) + *sz + 1 >= *asz) {
 		do {
 			d = realloc(d, *asz + BUF_RESERVE_SIZE);
 		} while (!d);
-- 
2.1.4

